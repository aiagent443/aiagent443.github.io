---
layout: default
title: Home
---

<h1>The Future of Learning Starts Here</h1>
<p>We are reimagining the way historical events are taught. Textbooks have remained the same for decades, relying on outdated methods of engagement.</p>
<p>In the new age of learning, attention spans are shorter than ever, and traditional education models fail to keep up. That's why we're developing an innovative, TikTok-powered approach to history education where immersive storytelling meets bite-sized learning.</p>
<p>Stay ahead of the curve and experience history like never before.</p>

<!-- This button starts the OAuth flow -->
<button class="custom-button" onclick="redirectToTikTok()" id="connectButton">Connect to TikTok</button>
<p id="statusMessage" style="display: none; color: #FF0050; margin-top: 10px;"></p>

<script>
  window.redirectToTikTok = function() {
    try {
      console.log("Button clicked - Starting OAuth flow");
      const button = document.getElementById('connectButton');
      const statusMessage = document.getElementById('statusMessage');
      button.disabled = true;
      statusMessage.textContent = "Connecting to TikTok...";
      statusMessage.style.display = "block";

      const clientKey = "sbawtupv4in9186fva";
      const redirectUri = "https://tiktok-oauth-backend.onrender.com/auth/callback";
      const state = Math.random().toString(36).substring(7);

      const params = new URLSearchParams({
        client_key: clientKey,
        scope: "user.info.profile,video.list",
        response_type: "code",
        redirect_uri: redirectUri,
        state: state
      });

      const tiktokAuthUrl = "https://www.tiktok.com/auth/authorize/?" + params.toString();

      console.log("Generated TikTok Auth URL:", tiktokAuthUrl);

      sessionStorage.setItem('oauth_state', state);

      window.location.href = tiktokAuthUrl;
    } catch (error) {
      console.error("Error in OAuth flow:", error);
      const statusMessage = document.getElementById('statusMessage');
      statusMessage.textContent = "An error occurred. Please try again.";
      statusMessage.style.display = "block";
      document.getElementById('connectButton').disabled = false;
    }
  };

  window.addEventListener('load', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');
    const state = urlParams.get('state');
    const error = urlParams.get('error');
    const errorDescription = urlParams.get('error_description');
    const statusMessage = document.getElementById('statusMessage');

    if (error) {
      console.error("OAuth Error:", error, errorDescription);
      statusMessage.textContent = `Authentication Error: ${errorDescription || error}`;
      statusMessage.style.display = "block";
      return;
    }

    if (code) {
      const storedState = sessionStorage.getItem('oauth_state');
      if (state !== storedState) {
        console.error("State mismatch - possible CSRF attack");
        statusMessage.textContent = "Security Error: Invalid state parameter";
        statusMessage.style.display = "block";
        return;
      }

      console.log("Authorization code received, sending to backend...");

      sessionStorage.removeItem('oauth_state');

      fetch("https://tiktok-oauth-backend.onrender.com/auth/callback", { // âœ… FIXED: Matched registered Redirect URI
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ code, state })
      })
      .then(response => {
        if (!response.ok) throw new Error("Backend server error");
        return response.json();
      })
      .then(data => {
        console.log("Successfully authenticated with TikTok:", data);
        statusMessage.textContent = "Successfully connected to TikTok!";
        statusMessage.style.color = "green";
        statusMessage.style.display = "block";
        setTimeout(() => {
          window.location.href = "/integration.html";
        }, 2000);
      })
      .catch(error => {
        console.error("Backend Error:", error);
        statusMessage.textContent = "Error processing authentication. Please try again.";
        statusMessage.style.display = "block";
        document.getElementById('connectButton').disabled = false;
      });
    }
  });
</script>
