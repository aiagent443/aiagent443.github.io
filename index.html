---
layout: default
title: Home
---

<h1>The Future of Learning Starts Here</h1>
<p>We are reimagining the way historical events are taught. Textbooks have remained the same for decades, relying on outdated methods of engagement.</p>
<p>In the new age of learning, attention spans are shorter than ever, and traditional education models fail to keep up. That's why we're developing an innovative, TikTok-powered approach to history education where immersive storytelling meets bite-sized learning.</p>
<p>Stay ahead of the curve and experience history like never before.</p>

<!-- This button starts the OAuth flow -->
<button class="custom-button" onclick="redirectToTikTok()" id="connectButton">Connect to TikTok</button>
<p id="statusMessage" style="display: none; color: #FF0050; margin-top: 10px;"></p>

<script>
  window.redirectToTikTok = function() {
    try {
      console.log("Button clicked - Starting OAuth flow");
      const button = document.getElementById('connectButton');
      const statusMessage = document.getElementById('statusMessage');
      button.disabled = true;
      statusMessage.textContent = "Connecting to TikTok...";
      statusMessage.style.display = "block";

      // Hardcoded values with maximum simplicity
      const clientKey = "sbawtupv4in9186fva";
      // Ensure no trailing slashes or extra characters
      const redirectUri = "https://tiktok-oauth-backend.onrender.com/auth/callback";
      // Simple random string for state
      const state = "state" + Math.floor(Math.random() * 1000000);
      
      // Super simple URL construction - avoid any complex encoding
      const tiktokAuthUrl = "https://www.tiktok.com/auth/authorize" + 
                           "?client_key=" + clientKey + 
                           "&scope=user.info.profile,video.list" + 
                           "&response_type=code" + 
                           "&redirect_uri=" + encodeURIComponent(redirectUri) + 
                           "&state=" + state;
      
      // Detailed logging
      console.log("=== TikTok OAuth Debug Info ===");
      console.log("Client Key:", clientKey);
      console.log("Redirect URI (before encoding):", redirectUri);
      console.log("Redirect URI (encoded):", encodeURIComponent(redirectUri));
      console.log("State:", state);
      console.log("Full Auth URL:", tiktokAuthUrl);
      
      // Store state in sessionStorage for verification
      sessionStorage.setItem('oauth_state', state);
      sessionStorage.setItem('oauth_debug_time', new Date().toString());
      
      // Add fallback for debugging
      sessionStorage.setItem('last_tiktok_auth_url', tiktokAuthUrl);
      
      // Redirect the browser to TikTok's OAuth endpoint
      window.location.href = tiktokAuthUrl;
    } catch (error) {
      console.error("Error in OAuth flow:", error);
      const statusMessage = document.getElementById('statusMessage');
      statusMessage.textContent = "An error occurred. Please try again.";
      statusMessage.style.display = "block";
      document.getElementById('connectButton').disabled = false;
    }
  };

  // Handle the OAuth callback
  window.addEventListener('load', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');
    const state = urlParams.get('state');
    const error = urlParams.get('error');
    const errorDescription = urlParams.get('error_description');
    const errorType = urlParams.get('error_type');
    const errCode = urlParams.get('errCode');
    const statusMessage = document.getElementById('statusMessage');

    // Enhanced error logging
    if (error) {
      console.error('=== TikTok OAuth Error ===');
      console.error('Error:', error);
      console.error('Error Description:', errorDescription);
      console.error('Error Type:', errorType);
      console.error('Error Code:', errCode);
      console.error('State:', state);
      console.error('Last Auth URL:', sessionStorage.getItem('last_tiktok_auth_url'));
      console.error('Auth Attempt Time:', sessionStorage.getItem('oauth_debug_time'));
      
      // Show detailed error to user
      statusMessage.innerHTML = `<strong>Authentication Error:</strong><br>
                               Type: ${errorType || error}<br>
                               Code: ${errCode || 'N/A'}<br>
                               Details: ${errorDescription || 'No details provided'}<br>
                               <small>Please check console for more information</small>`;
      statusMessage.style.display = "block";
      return;
    }

    if (code) {
      console.log('=== TikTok OAuth Success ===');
      console.log('Authorization code received');
      console.log('State:', state);
      
      const storedState = sessionStorage.getItem('oauth_state');
      if (state !== storedState) {
        console.error('State mismatch - possible CSRF attack');
        console.error('Received state:', state);
        console.error('Stored state:', storedState);
        statusMessage.textContent = 'Security Error: Invalid state parameter';
        statusMessage.style.display = "block";
        return;
      }

      console.log('State verification successful');
      // Clear the stored state
      sessionStorage.removeItem('oauth_state');
      sessionStorage.removeItem('oauth_debug_time');
      sessionStorage.removeItem('last_tiktok_auth_url');

      // Show processing message
      statusMessage.textContent = 'Processing authentication...';
      statusMessage.style.display = "block";

      // Send the code to your backend
      console.log('Sending code to backend...');
      fetch('https://tiktok-oauth-backend.onrender.com/auth/callback', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          code: code,
          state: state
        })
      })
      .then(response => {
        console.log('Backend response status:', response.status);
        if (!response.ok) {
          throw new Error('Backend server error: ' + response.status);
        }
        return response.json();
      })
      .then(data => {
        console.log('Backend response data:', data);
        statusMessage.textContent = 'Successfully connected to TikTok!';
        statusMessage.style.color = 'green';
        statusMessage.style.display = "block";
        // Redirect to integration page or show success UI
        setTimeout(() => {
          window.location.href = '/integration.html';
        }, 2000);
      })
      .catch(error => {
        console.error('Backend Error:', error);
        statusMessage.textContent = 'Error processing authentication: ' + error.message;
        statusMessage.style.display = "block";
        document.getElementById('connectButton').disabled = false;
      });
    }
  });
</script>
