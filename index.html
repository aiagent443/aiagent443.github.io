---
layout: default
title: Home
---

<h1>The Future of Learning Starts Here</h1>
<p>We are reimagining the way historical events are taught. Textbooks have remained the same for decades, relying on outdated methods of engagement.</p>
<p>In the new age of learning, attention spans are shorter than ever, and traditional education models fail to keep up. That's why we're developing an innovative, TikTok-powered approach to history education where immersive storytelling meets bite-sized learning.</p>
<p>Stay ahead of the curve and experience history like never before.</p>

<!-- This button starts the OAuth flow -->
<button class="custom-button" onclick="redirectToTikTok()" id="connectButton">Connect to TikTok</button>
<p id="statusMessage" style="display: none; color: #FF0050; margin-top: 10px;"></p>

<script>
  window.redirectToTikTok = function() {
    try {
      console.log("Starting OAuth flow");
      const button = document.getElementById('connectButton');
      const statusMessage = document.getElementById('statusMessage');
      button.disabled = true;
      statusMessage.textContent = "Connecting to TikTok...";
      statusMessage.style.display = "block";

      // Create a form and submit it instead of using window.location
      // This prevents issues with URL parameter encoding
      const form = document.createElement('form');
      form.method = 'GET';
      form.action = 'https://www.tiktok.com/auth/authorize';
      form.style.display = 'none';
      
      // Add client key
      const clientKeyInput = document.createElement('input');
      clientKeyInput.type = 'hidden';
      clientKeyInput.name = 'client_key';
      clientKeyInput.value = 'sbawtupv4in9186fva';
      form.appendChild(clientKeyInput);
      
      // Add scope
      const scopeInput = document.createElement('input');
      scopeInput.type = 'hidden';
      scopeInput.name = 'scope';
      scopeInput.value = 'user.info.profile,video.list';
      form.appendChild(scopeInput);
      
      // Add response type
      const responseTypeInput = document.createElement('input');
      responseTypeInput.type = 'hidden';
      responseTypeInput.name = 'response_type';
      responseTypeInput.value = 'code';
      form.appendChild(responseTypeInput);
      
      // Add redirect URI
      const redirectUriInput = document.createElement('input');
      redirectUriInput.type = 'hidden';
      redirectUriInput.name = 'redirect_uri';
      redirectUriInput.value = 'https://tiktok-oauth-backend.onrender.com/auth/callback';
      form.appendChild(redirectUriInput);
      
      // Add state
      const state = "state" + Math.floor(Math.random() * 1000000);
      const stateInput = document.createElement('input');
      stateInput.type = 'hidden';
      stateInput.name = 'state';
      stateInput.value = state;
      form.appendChild(stateInput);
      
      // Store state for verification
      sessionStorage.setItem('oauth_state', state);
      
      // Add form to body and submit
      document.body.appendChild(form);
      console.log("Submitting form to TikTok OAuth...");
      form.submit();
    } catch (error) {
      console.error("Error:", error);
      const statusMessage = document.getElementById('statusMessage');
      statusMessage.textContent = "An error occurred. Please try again.";
      statusMessage.style.display = "block";
      document.getElementById('connectButton').disabled = false;
    }
  };

  // Handle the OAuth callback
  window.addEventListener('load', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');
    const state = urlParams.get('state');
    const error = urlParams.get('error');
    const statusMessage = document.getElementById('statusMessage');

    // Handle errors
    if (error) {
      console.error('OAuth Error:', error, 
                   'Type:', urlParams.get('error_type'), 
                   'Code:', urlParams.get('errCode'));
      
      statusMessage.textContent = `Authentication Error: ${urlParams.get('error_description') || error}`;
      statusMessage.style.display = "block";
      return;
    }

    if (code) {
      // Verify state
      const storedState = sessionStorage.getItem('oauth_state');
      if (state !== storedState) {
        console.error('State mismatch');
        statusMessage.textContent = 'Security Error: Invalid state parameter';
        statusMessage.style.display = "block";
        return;
      }

      // Clean up
      sessionStorage.removeItem('oauth_state');
      sessionStorage.removeItem('oauth_url');

      // Process authentication
      statusMessage.textContent = 'Processing authentication...';
      statusMessage.style.display = "block";

      // Send to backend
      fetch('https://tiktok-oauth-backend.onrender.com/auth/callback', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ code, state })
      })
      .then(response => {
        if (!response.ok) throw new Error('Server error: ' + response.status);
        return response.json();
      })
      .then(data => {
        statusMessage.textContent = 'Successfully connected to TikTok!';
        statusMessage.style.color = 'green';
        statusMessage.style.display = "block";
        setTimeout(() => { window.location.href = '/integration.html'; }, 2000);
      })
      .catch(error => {
        console.error('Backend Error:', error);
        statusMessage.textContent = 'Error: ' + error.message;
        statusMessage.style.display = "block";
        document.getElementById('connectButton').disabled = false;
      });
    }
  });
</script>
